{% extends 'base.html' %}
{% load static %}
{% load template_filters %}
{% load gravatar %}
{% block header %}{% include 'parts/header.html' %}{% endblock %}
{% block content %}
    <section class="home">
        <div class="container">
            {% if user.account.is_active %}
                <div class="left">
                    <div class="profile">
                        <h3>Пользователь</h3>
                        <div class="userinfo">
                            <div class="avatar">
                                <img src="{{ user.email|gravatar_url }}" alt="gravatar">
                            </div>
                            <section>
                                <form method="post">
                                    {% csrf_token %}
                                    {{ user_form.as_p }}
                                    <a href="{% url 'password_change' %}">Change password</a>
                                    <br/>
                                    <button name="user_submit" type="submit">Save</button>
                                </form>
                            </section>
                        </div>
                    </div>
                </div>
            {% endif %}
        </div>
    </section>
    <main>
        <div class="container">
        {% if user.account.is_active %}
            {% if user.agency %}
                <div class="agency_info">
                    <h3>Турагенство</h3>
                    <form method="post">
                        {% csrf_token %}
                        {{ agency_form.as_p }}
                        {{ address_form.as_p }}
                        <button name="agency_submit" type="submit">Save</button>
                    </form>
                </div>
            {% endif %}
        {% endif %}
        </div>
    </main>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ol3/4.6.5/ol.js"></script>
    <script src="http://openlayers.org/en/v3.11.2/build/ol.js"></script>
    <script src="{% static 'gis/js/OLMapWidget.js' %}"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@6.14.1/ol.css" type="text/css">
    <script src="https://cdn.jsdelivr.net/npm/ol@6.14.1/dist/ol.js" defer></script>
    <script>
        var base_layer = new ol.layer.Tile({
            source: new ol.source.OSM()
        });
        var options = {
            base_layer: base_layer,
            geom_name: 'Point',
            id: 'id_point',
            map_id: 'id_point_map',
            map_srid: 3857,
            name: 'point'
        };

        options['default_lon'] = 5;
        options['default_lat'] = 47;
        options['default_zoom'] = 12;

        var geodjango_point = new MapWidget(options);
    </script>
{% endblock %}